@model BookStore.Models.BookDetailViewModel
@{ ViewData["Title"] = Model.Book.Name; }

<div class="container py-5">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-action="Index" class="text-decoration-none text-muted">Trang chủ</a></li>
            <li class="breadcrumb-item active" aria-current="page">Chi tiết sách</li>
        </ol>
    </nav>

    <div class="row g-5 mt-2">
        <div class="col-md-5 text-center">
            <img src="/@Model.Book.ImagePath" class="img-fluid shadow-sm rounded" style="max-height: 500px;" alt="@Model.Book.Name">
        </div>
        <div class="col-md-7">
            <div class="mb-2">
                @foreach(var cat in Model.Categories)
                {
                <span class="badge bg-secondary me-1">@cat</span>
                }
            </div>

            <h1 class="display-5 fw-bold mb-3" style="font-family: 'Playfair Display', serif;">@Model.Book.Name</h1>

            <div class="fs-5 mb-2">
                <span class="fw-bold text-dark">Tác giả:</span>
                <span class="text-danger">@(Model.Authors.Count > 0 ? string.Join(", ", Model.Authors) : "Đang cập nhật")</span>
            </div>

            <div class="fs-6 mb-3 text-muted">
                <i class="fas fa-building me-1"></i> Nhà xuất bản: @Model.PublisherName
            </div>

            <div class="h2 text-dark fw-bold mb-4">@Model.Book.Price.ToString("#,##0") đ</div>

            <p class="lead text-muted mb-4" style="font-size: 0.95rem;">
                @(string.IsNullOrEmpty(Model.Book.Description) ? "Thông tin mô tả đang cập nhật..." : Model.Book.Description)
            </p>

            <div class="d-flex align-items-center gap-3 mb-4">
                <div class="badge bg-light text-dark border p-2">Kho còn: @Model.Book.Quantity</div>
            </div>

            <button class="btn btn-dark btn-lg rounded-0 px-5 py-3 text-uppercase fw-bold"
                    onclick="addToCart(@Model.Book.Id, '@Model.Book.Name', @Model.Book.Price, '@Model.Book.ImagePath', @Model.Book.Quantity)">
                <i class="fas fa-shopping-bag me-2"></i> Thêm vào giỏ hàng
            </button>
        </div>
    </div>
</div>

<script>
    function addToCart(id, name, price, image, maxStock) {
        let cart = JSON.parse(localStorage.getItem("BOOK_CART")) || [];
        let item = cart.find(x => x.id === id);
        if (item) {
            if (item.quantity >= maxStock) {
                alert("Đã đạt giới hạn số lượng trong kho!");
                return;
            }
            item.quantity++;
        } else {
            cart.push({ id, name, price, image: '/' + image, quantity: 1, maxStock });
        }
        localStorage.setItem("BOOK_CART", JSON.stringify(cart));
        if (typeof updateCartBadge === "function") updateCartBadge();
        alert("Đã thêm sách vào giỏ hàng!");
    }
</script>